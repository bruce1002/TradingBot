<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView Binance Bot - Dashboard</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
    <!-- È†ÅÈù¢ Header -->
    <header class="page-header">
        <h1>TradingView Binance Bot Dashboard</h1>
        <div class="user-info">
            <span>ÁôªÂÖ•Â∏≥ËôüÔºö{{ user_email or "Êú™Áü•" }}</span>
            <button id="logout-btn">ÁôªÂá∫</button>
        </div>
    </header>

    <!-- ‰∏ªË¶ÅÂÖßÂÆπÂçÄ -->
    <main class="page-main">
        <!-- ÂÄâ‰ΩçË°®Ê†ºÂçÄÂ°ä -->
        <section class="positions-section">
            <div class="positions-header">
                <h2>üìí Positions</h2>
                <div class="positions-tabs">
                    <button class="tab-button active" data-tab="bot">Bot Positions</button>
                    <button class="tab-button" data-tab="binance">Binance Live Positions</button>
                    <button class="tab-button" data-tab="signals">Signals</button>
                    <button class="tab-button" data-tab="bots">Bots</button>
                    <button class="tab-button" data-tab="pending">Pending Orders</button>
                </div>
            </div>
            
            <!-- Trailing Settings -->
            <div class="trailing-settings">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <!-- LONG Settings -->
                    <div style="border: 1px solid var(--border-color, #333); padding: 15px; border-radius: 8px; background: var(--card-bg, #1e1e1e);">
                        <h4 style="margin: 0 0 15px 0; color: var(--pnl-positive, #00ff88);">LONG Positions</h4>
                        <label class="setting-item">
                            <span>PnL% threshold (%):</span>
                            <input type="number" id="profit-threshold-long" step="0.1" min="0" class="setting-input">
                        </label>
                        <label class="setting-item">
                            <span>Lock ratio:</span>
                            <input type="number" id="lock-ratio-long" step="0.05" min="0" max="1" class="setting-input">
                        </label>
                        <label class="setting-item">
                            <span>Base SL (%):</span>
                            <input type="number" id="base-sl-long" step="0.1" min="0" class="setting-input">
                        </label>
                    </div>
                    
                    <!-- SHORT Settings -->
                    <div style="border: 1px solid var(--border-color, #333); padding: 15px; border-radius: 8px; background: var(--card-bg, #1e1e1e);">
                        <h4 style="margin: 0 0 15px 0; color: var(--pnl-negative, #ff4444);">SHORT Positions</h4>
                        <label class="setting-item">
                            <span>PnL% threshold (%):</span>
                            <input type="number" id="profit-threshold-short" step="0.1" min="0" class="setting-input">
                        </label>
                        <label class="setting-item">
                            <span>Lock ratio:</span>
                            <input type="number" id="lock-ratio-short" step="0.05" min="0" max="1" class="setting-input">
                        </label>
                        <label class="setting-item">
                            <span>Base SL (%):</span>
                            <input type="number" id="base-sl-short" step="0.1" min="0" class="setting-input">
                        </label>
                    </div>
                </div>
                <button id="save-trailing-settings" class="action-btn">Save</button>
                <div class="setting-note">
                    <small>Note: Dynamic Stop and Auto close are always enabled by default.</small>
                </div>
            </div>
            
            <p class="subtitle">
                <span class="tag-dyn">Dynamic Stop</span>
                vs
                <span class="tag-base">Base Stop-Loss</span>
            </p>

            <!-- Bot Positions -->
            <div id="bot-positions-container" class="positions-container active">
                <!-- Filter and Delete Section -->
                <div class="positions-filter-section">
                    <h3>Filter & Manage Positions</h3>
                    <div class="filter-row">
                        <label>
                            Symbol:
                            <select id="filter-symbol">
                                <option value="">All</option>
                            </select>
                        </label>
                        <label>
                            Status:
                            <select id="filter-status">
                                <option value="">All</option>
                                <option value="OPEN">OPEN</option>
                                <option value="CLOSED">CLOSED</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </label>
                        <label>
                            From Date:
                            <input type="date" id="filter-start-date">
                        </label>
                        <label>
                            To Date:
                            <input type="date" id="filter-end-date">
                        </label>
                        <button id="apply-filter-btn" class="action-btn">Apply Filter</button>
                        <button id="clear-filter-btn" class="btn-secondary">Clear</button>
                    </div>
                    <div class="delete-actions-row">
                        <label>
                            Delete positions older than (days):
                            <input type="number" id="delete-days" min="1" max="365" value="30" style="width: 80px;">
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="delete-include-error">
                            <span>Include ERROR positions</span>
                        </label>
                        <button id="delete-old-positions-btn" class="btn-danger">Delete Old Positions</button>
                        <button id="clear-error-positions-btn" class="btn-danger">Clear All ERROR Positions</button>
                        <button id="bot-export-excel" class="action-btn">Export Excel</button>
                    </div>
                </div>
                
                <div id="positions-table-container">
                    <!-- ËºâÂÖ•‰∏≠... -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        ËºâÂÖ•‰∏≠...
                    </div>
                </div>
                
                <!-- Êó•ÊúüÁØ©ÈÅ∏ÂíåÁµ±Ë®àÂçÄÂ°äÔºàÂú®Ë°®Ê†º‰∏ãÊñπÔºâ -->
                <div class="bot-stats-section">
                    <!-- Êó•ÊúüÁØ©ÈÅ∏ÂíåÂåØÂá∫ÊåâÈàï -->
                    <div id="bot-positions-filter" class="bot-filter-row">
                        <label>From: <input type="date" id="bot-start-date"></label>
                        <label>To: <input type="date" id="bot-end-date"></label>
                        <button id="bot-apply-filter" class="action-btn">Apply</button>
                    </div>
                    
                    <!-- Áµ±Ë®àË≥áË®ä -->
                    <div id="bot-positions-stats" class="bot-stats-row">
                        <!-- Áî± JS Ê≥®ÂÖ•ÂÖßÂÆπ -->
                    </div>
                </div>
            </div>

            <!-- Binance Live Positions -->
            <div id="binance-positions-container" class="positions-container">
                <!-- Portfolio Summary and Controls -->
                <div class="portfolio-controls" style="margin-bottom: 20px; padding: 20px; background: var(--card-bg, #1e1e1e); border-radius: 8px; border: 1px solid var(--border-color, #333);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: var(--text-primary, #fff);">Portfolio Summary & Trailing Stop</h3>
                        <button id="close-all-positions-btn" class="btn-danger" style="padding: 8px 16px;">Close All Positions</button>
                    </div>
                    
                    <!-- LONG Category -->
                    <div style="margin-bottom: 30px; padding: 15px; background: var(--card-bg, #252525); border-radius: 6px; border: 1px solid var(--border-color, #444);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: var(--pnl-positive, #00ff88);">LONG Positions</h4>
                            <button id="close-all-long-positions-btn" class="btn-danger" style="padding: 6px 12px; background: var(--pnl-positive, #00ff88); color: #000; border: none; font-size: 12px;">Close All LONG</button>
                        </div>
                        
                        <!-- LONG Portfolio Summary -->
                        <div id="portfolio-summary-long" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="color: var(--text-muted, #888); font-size: 12px; margin-bottom: 5px;">Total Unrealized PnL</div>
                                <div id="total-pnl-long" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                            <div>
                                <div style="color: var(--text-muted, #888); font-size: 12px; margin-bottom: 5px;">Position Count</div>
                                <div id="position-count-long" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <div style="color: var(--text-muted, #888); font-size: 12px;">Max PnL Reached</div>
                                    <button id="reset-max-pnl-btn-long" class="action-btn" style="padding: 3px 6px; font-size: 10px; line-height: 1;" title="ÈáçÁΩÆ Max PnL Reached (LONG)">Reset</button>
                                </div>
                                <div id="max-pnl-reached-long" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                        </div>
                        
                        <!-- LONG Portfolio Trailing Stop Controls -->
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color, #444);">
                            <h5 style="margin: 0 0 10px 0; color: var(--text-primary, #fff); font-size: 14px;">Portfolio Trailing Stop (LONG)</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Enable Auto Sell:</span>
                                    <input type="checkbox" id="portfolio-trailing-enabled-long" style="width: auto; margin-top: 5px;">
                                </label>
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Target PnL per Position (USDT):</span>
                                    <input type="number" id="portfolio-target-pnl-long" step="0.01" min="0" class="setting-input" placeholder="e.g., 50">
                                    <small id="threshold-display-long" style="color: var(--text-muted, #888); font-size: 10px; margin-top: 4px; line-height: 1.4;">ÂØ¶ÈöõËß∏ÁôºÈñÄÊ™ª = Ê≠§ÂÄº √ó ÈñãÂïüÂÄâ‰ΩçÊï∏Èáè</small>
                                </label>
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Lock Ratio:</span>
                                    <input type="number" id="portfolio-lock-ratio-long" step="0.05" min="0" max="1" class="setting-input" placeholder="e.g., 0.65">
                                </label>
                                <button id="save-portfolio-trailing-btn-long" class="action-btn" style="padding: 8px 16px; font-size: 12px;">Save Config (LONG)</button>
                            </div>
                            <div style="margin-top: 8px; color: var(--text-muted, #888); font-size: 11px;">
                                <small>When total LONG PnL reaches (Target PnL per Position √ó Position Count), max PnL is recorded. If PnL falls to (Max PnL √ó Lock Ratio), all LONG positions will be closed automatically.</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SHORT Category -->
                    <div style="padding: 15px; background: var(--card-bg, #252525); border-radius: 6px; border: 1px solid var(--border-color, #444);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: var(--pnl-negative, #ff4444);">SHORT Positions</h4>
                            <button id="close-all-short-positions-btn" class="btn-danger" style="padding: 6px 12px; background: var(--pnl-negative, #ff4444); color: #fff; border: none; font-size: 12px;">Close All SHORT</button>
                        </div>
                        
                        <!-- SHORT Portfolio Summary -->
                        <div id="portfolio-summary-short" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="color: var(--text-muted, #888); font-size: 12px; margin-bottom: 5px;">Total Unrealized PnL</div>
                                <div id="total-pnl-short" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                            <div>
                                <div style="color: var(--text-muted, #888); font-size: 12px; margin-bottom: 5px;">Position Count</div>
                                <div id="position-count-short" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <div style="color: var(--text-muted, #888); font-size: 12px;">Max PnL Reached</div>
                                    <button id="reset-max-pnl-btn-short" class="action-btn" style="padding: 3px 6px; font-size: 10px; line-height: 1;" title="ÈáçÁΩÆ Max PnL Reached (SHORT)">Reset</button>
                                </div>
                                <div id="max-pnl-reached-short" style="font-size: 20px; font-weight: bold; color: var(--text-primary, #fff);">-</div>
                            </div>
                        </div>
                        
                        <!-- SHORT Portfolio Trailing Stop Controls -->
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color, #444);">
                            <h5 style="margin: 0 0 10px 0; color: var(--text-primary, #fff); font-size: 14px;">Portfolio Trailing Stop (SHORT)</h5>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Enable Auto Sell:</span>
                                    <input type="checkbox" id="portfolio-trailing-enabled-short" style="width: auto; margin-top: 5px;">
                                </label>
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Target PnL per Position (USDT):</span>
                                    <input type="number" id="portfolio-target-pnl-short" step="0.01" min="0" class="setting-input" placeholder="e.g., 50">
                                    <small id="threshold-display-short" style="color: var(--text-muted, #888); font-size: 10px; margin-top: 4px; line-height: 1.4;">ÂØ¶ÈöõËß∏ÁôºÈñÄÊ™ª = Ê≠§ÂÄº √ó ÈñãÂïüÂÄâ‰ΩçÊï∏Èáè</small>
                                </label>
                                <label class="setting-item" style="display: flex; flex-direction: column;">
                                    <span>Lock Ratio:</span>
                                    <input type="number" id="portfolio-lock-ratio-short" step="0.05" min="0" max="1" class="setting-input" placeholder="e.g., 0.65">
                                </label>
                                <button id="save-portfolio-trailing-btn-short" class="action-btn" style="padding: 8px 16px; font-size: 12px;">Save Config (SHORT)</button>
                            </div>
                            <div style="margin-top: 8px; color: var(--text-muted, #888); font-size: 11px;">
                                <small>When total SHORT PnL reaches (Target PnL per Position √ó Position Count), max PnL is recorded. If PnL falls to (Max PnL √ó Lock Ratio), all SHORT positions will be closed automatically.</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="binance-table-container">
                    <!-- ËºâÂÖ•‰∏≠... -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        ËºâÂÖ•‰∏≠...
                    </div>
                </div>
            </div>

            <!-- Signals -->
            <div id="signals-container" class="positions-container">
                <!-- Signal Configs Section -->
                <div id="signal-configs-section">
                    <div class="bots-header-row">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button id="toggle-signal-configs-section-btn" class="toggle-section-btn" style="background: none; border: none; color: var(--text-primary, #fff); font-size: 16px; cursor: pointer; padding: 4px 8px;">‚ñº</button>
                            <h2 class="section-title">TradingView Signal Configs <span id="signal-configs-count"></span></h2>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="clear-signal-logs-btn" class="btn-danger">Clear Signal Logs</button>
                            <button id="btn-open-signal-form" class="action-btn">New Signal</button>
                        </div>
                    </div>
                    
                    <!-- Signal Create/Edit Form (Initially Hidden) -->
                    <div id="signal-form-container" class="bot-form-card" style="display:none;">
                        <h3 id="signal-form-title">Create New Signal</h3>
                        <form id="signal-create-form">
                            <!-- First Row: Name / Signal Key -->
                            <div class="form-row">
                                <label>
                                    Name <span class="required">*</span>
                                    <input type="text" id="signal-name" required placeholder="Signal name" />
                                </label>
                                <label>
                                    Signal Key <span class="required">*</span>
                                    <input type="text" id="signal-key" required placeholder="Unique signal key" />
                                </label>
                            </div>

                            <!-- Second Row: Symbol Hint / Timeframe Hint -->
                            <div class="form-row">
                                <label>
                                    Symbol Hint
                                    <input type="text" id="signal-symbol-hint" placeholder="e.g. BTCUSDT" />
                                </label>
                                <label>
                                    Timeframe
                                    <input type="text" id="signal-timeframe-hint" placeholder="e.g. 15m / 1h" />
                                </label>
                            </div>

                            <!-- Third Row: Description / Enabled -->
                            <div class="form-row">
                                <label>
                                    Description
                                    <input type="text" id="signal-description" placeholder="Signal description" />
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="signal-enabled" checked />
                                    <span>Enabled</span>
                                </label>
                            </div>

                            <!-- TradingView Alert Template -->
                            <div class="form-row">
                                <label style="flex: 1 1 100%;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                        <span>TradingView Alert Template</span>
                                        <button type="button" id="btn-copy-alert-template" class="action-btn" style="padding: 4px 12px; font-size: 12px; height: auto;">
                                            <span id="copy-btn-text">Copy</span>
                                        </button>
                                    </div>
                                    <textarea id="signal-alert-template" readonly rows="8" style="width: 100%; padding: 8px; background-color: var(--tbl-bg); border: 1px solid var(--tbl-border); color: var(--tbl-text); border-radius: 4px; font-family: monospace; font-size: 12px;"></textarea>
                                    <small style="color: var(--tbl-muted); font-size: 11px;">Ë§áË£ΩÊ≠§ JSON Âà∞ TradingView Alert Ë®≠ÂÆö‰∏≠</small>
                                </label>
                            </div>

                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="submit" class="action-btn" id="signal-form-submit-btn">Save</button>
                                <button type="button" id="btn-cancel-signal-form" class="action-btn">Cancel</button>
                            </div>

                            <div id="signal-form-error" class="form-error" style="display:none;"></div>
                        </form>
                    </div>
                    
                    <!-- Signal Configs Table -->
                    <div id="signal-configs-table-container">
                        <!-- ËºâÂÖ•‰∏≠... -->
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            ËºâÂÖ•‰∏≠...
                        </div>
                    </div>
                </div>
                
                <!-- Signal Logs (‰øùÁïôÂéüÊúâÂäüËÉΩ) -->
                <div id="signals-table-section" style="margin-top: 32px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <button id="toggle-signal-logs-section-btn" class="toggle-section-btn" style="background: none; border: none; color: var(--text-primary, #fff); font-size: 16px; cursor: pointer; padding: 4px 8px;">‚ñº</button>
                        <h3 class="section-title">Signal Logs <span id="signals-count"></span></h3>
                    </div>
                    <div id="signals-table-container">
                        <!-- ËºâÂÖ•‰∏≠... -->
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            ËºâÂÖ•‰∏≠...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bots -->
            <div id="bots-container" class="positions-container">
                <!-- Bots Header with New Bot Button -->
                <div class="bots-header-row">
                    <h2 class="section-title">Bots</h2>
                    <div style="display: flex; gap: 10px;">
                        <!-- Bulk Update Sections -->
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                            <!-- Bulk Update Invest Amount Section -->
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" step="0.01" min="0" id="bulk-update-invest-amount" placeholder="Investment (USDT)" style="width: 150px; padding: 6px 10px; background-color: var(--tbl-bg); border: 1px solid var(--tbl-border); color: var(--tbl-text); border-radius: 4px;" />
                                <button id="btn-bulk-update-invest-amount" class="action-btn" style="padding: 6px 16px;">Update All Bots</button>
                            </div>
                            <!-- Bulk Update Trading Mode Section -->
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <select id="bulk-update-trading-mode" style="width: 150px; padding: 6px 10px; background-color: var(--tbl-bg); border: 1px solid var(--tbl-border); color: var(--tbl-text); border-radius: 4px;">
                                    <option value="auto">Full-Auto</option>
                                    <option value="semi-auto">Semi-Auto</option>
                                    <option value="manual">Manual</option>
                                </select>
                                <button id="btn-bulk-update-trading-mode" class="action-btn" style="padding: 6px 16px;">Update All Trading Mode</button>
                            </div>
                        </div>
                        <button id="btn-open-bot-form" class="action-btn">New Bot</button>
                    </div>
                </div>
                
                <!-- Bulk Update Result Message -->
                <div id="bulk-update-result" style="display: none; margin: 10px 0; padding: 10px; border-radius: 4px;"></div>
                
                <!-- Bot Create Form (Initially Hidden) -->
                <div id="bot-form-container" class="bot-form-card" style="display:none;">
                    <h3>Create New Bot</h3>
                    <form id="bot-create-form">
                        <!-- First Row: Name / Bot Key -->
                        <div class="form-row">
                            <label>
                                Name <span class="required">*</span>
                                <input type="text" id="bot-name" required placeholder="Bot name" />
                            </label>
                            <label>
                                Bot Key <span class="required">*</span>
                                <input type="text" id="bot-key" required placeholder="Unique bot key" />
                            </label>
                        </div>

                        <!-- Second Row: Symbol / Qty / Max Invest USDT / Leverage -->
                        <div class="form-row">
                            <label>
                                Symbol <span class="required">*</span>
                                <input list="symbol-suggestions" id="bot-symbol" required placeholder="BTCUSDT" />
                                <datalist id="symbol-suggestions">
                                    <!-- JS will populate this -->
                                </datalist>
                            </label>
                            <label class="with-tooltip">
                                Qty
                                <input type="number" step="0.0001" min="0" id="bot-qty" placeholder="0.01" />
                                <span class="tooltip-icon" title="‰∫§ÊòìÊï∏ÈáèÔºàÁï∂ Max Invest USDT Êú™Ë®≠ÂÆöÊôÇ‰ΩøÁî®Ôºâ">?</span>
                            </label>
                            <label class="with-tooltip">
                                Max Invest (USDT)
                                <input type="number" step="0.01" min="0" id="bot-max-invest-usdt" placeholder="50.0" />
                                <span class="tooltip-icon" title="ÊúÄÂ§ßÊäïË≥áÈáëÈ°çÔºàUSDTÔºâ„ÄÇÂ¶ÇÊûúË®≠ÂÆöÔºåÁ≥ªÁµ±ÊúÉÊ†πÊìöÁï∂ÂâçÂÉπÊ†ºËá™ÂãïË®àÁÆó qtyÔºå‰∏î‰∏çÊúÉË∂ÖÈÅéÊ≠§ÈáëÈ°ç">?</span>
                            </label>
                            <label>
                                Leverage <span class="required">*</span>
                                <input type="number" step="1" min="1" max="125" id="bot-leverage" required placeholder="5" />
                            </label>
                        </div>

                        <!-- Third Row: Signal / Side Source -->
                        <div class="form-row">
                            <label>
                                Signal
                                <select id="bot-signal-id">
                                    <option value="">(None - independent bot)</option>
                                    <!-- JS will populate this -->
                                </select>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="bot-use-signal-side" checked />
                                <span>Use side from TradingView signal</span>
                            </label>
                            <label>
                                Fixed Side
                                <select id="bot-fixed-side">
                                    <option value="">(None - use signal side)</option>
                                    <option value="BUY">LONG (Buy)</option>
                                    <option value="SELL">SHORT (Sell)</option>
                                </select>
                            </label>
                        </div>

                        <!-- Fourth Row: Dynamic Stop Settings -->
                        <div class="form-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="bot-use-dynamic-stop" checked />
                                <span>Enable Dynamic Stop</span>
                                <span class="tooltip-icon" title="ÂãæÈÅ∏ÂæåÔºåÊ≠§ bot ÊúÉ‰ΩøÁî®ÂãïÊÖãÂÅúÊêçÔºöÈÅîÂà∞Áç≤Âà©ÈñÄÊ™ªÂæåÔºåÈéñ‰ΩèÈÉ®ÂàÜÁç≤Âà©‰∏¶ËøΩËπ§ÂÅúÂà©">?</span>
                            </label>
                            <label class="with-tooltip">
                                Dynamic Lock (%)
                                <input type="number" step="0.1" min="0" max="100" id="bot-trailing-callback-percent" placeholder="10.0" />
                                <span class="tooltip-icon" title="ÈéñÂà©ÊØî‰æãÔºö‰æãÂ¶Ç 50% ‰ª£Ë°®‰∏ÄÊó¶ÈÅîÂà∞Áç≤Âà©ÈñÄÊ™ªÂæåÔºåÁ≥ªÁµ±ÊúÉÈéñ‰ΩèÂ∑≤ÂØ¶ÁèæÁç≤Âà©ÁöÑ‰∏ÄÂçäÔºåÂÉπÊ†ºÂõûÊí§Âà∞Ë©≤ÂÉπ‰ΩçÊôÇËß∏ÁôºÂÅúÊêç">?</span>
                            </label>
                            <label class="with-tooltip">
                                Base SL (%)
                                <input type="number" step="0.1" min="0" max="100" id="bot-base-stop-loss-pct" placeholder="5.0" />
                                <span class="tooltip-icon" title="Âü∫Á§éÂÅúÊêçÔºöÊú™ÈÅîÊàêÂãïÊÖãÂÅúÂà©ÈñÄÊ™ªÂâçÔºåËã•ÂÉπÊ†ºÂèçÂêëË∂ÖÈÅéÊ≠§ÁôæÂàÜÊØîÔºåÂâáËß∏ÁôºÂÅúÊêç">?</span>
                            </label>
                        </div>

                        <!-- Fifth Row: Trading Mode / Enabled -->
                        <div class="form-row">
                            <label class="with-tooltip">
                                Trading Mode <span class="required">*</span>
                                <select id="bot-trading-mode" required>
                                    <option value="auto" selected>Full-Auto (Ëá™ÂãïÂü∑Ë°å)</option>
                                    <option value="semi-auto">Semi-Auto (ÈúÄÊâπÂáÜ)</option>
                                    <option value="manual">Manual (ÂÉÖÊâãÂãï)</option>
                                </select>
                                <span class="tooltip-icon" title="Full-Auto: Ë®äËôüÁ´ãÂç≥Âü∑Ë°å | Semi-Auto: Ë®äËôüÈúÄ‰ΩøÁî®ËÄÖÊâπÂáÜÂæåÂü∑Ë°å | Manual: ÂøΩÁï•Ë®äËôüÔºåÂÉÖÊâãÂãï‰∫§Êòì">?</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="bot-enabled" checked />
                                <span>Enabled</span>
                            </label>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="submit" class="action-btn">Create Bot</button>
                            <button type="button" id="btn-cancel-bot-form" class="action-btn">Cancel</button>
                        </div>

                        <div id="bot-form-error" class="form-error" style="display:none;"></div>
                    </form>
                </div>
                
                <div id="bots-table-container">
                    <!-- ËºâÂÖ•‰∏≠... -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        ËºâÂÖ•‰∏≠...
                    </div>
                </div>
            </div>

            <!-- Pending Orders -->
            <div id="pending-container" class="positions-container">
                <div class="bots-header-row">
                    <h2 class="section-title">Pending Orders</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="btn-clear-executed-pending-orders" class="btn-danger" title="Delete all EXECUTED pending orders">Clear Executed</button>
                        <button id="btn-refresh-pending-orders" class="action-btn">Refresh</button>
                    </div>
                </div>
                
                <!-- Filter Section -->
                <div class="positions-filter-section">
                    <h3>Filter Pending Orders</h3>
                    <div class="filter-row">
                        <label>
                            Status:
                            <select id="filter-pending-status">
                                <option value="">All</option>
                                <option value="PENDING">PENDING</option>
                                <option value="APPROVED">APPROVED</option>
                                <option value="REJECTED">REJECTED</option>
                                <option value="EXECUTED">EXECUTED</option>
                                <option value="FAILED">FAILED</option>
                            </select>
                        </label>
                        <label>
                            Bot ID:
                            <input type="number" id="filter-pending-bot-id" placeholder="Filter by Bot ID" />
                        </label>
                        <button id="apply-pending-filter-btn" class="action-btn">Apply Filter</button>
                        <button id="clear-pending-filter-btn" class="btn-secondary">Clear</button>
                    </div>
                </div>
                
                <div id="pending-orders-table-container">
                    <!-- ËºâÂÖ•‰∏≠... -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        ËºâÂÖ•‰∏≠...
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Signal Detail Modal -->
    <div id="signal-detail-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Signal Detail</h3>
          <button id="signal-detail-close" class="modal-close">√ó</button>
        </div>
        <div class="modal-body">
          <div class="modal-section">
            <h4>Metadata</h4>
            <pre id="signal-detail-meta"></pre>
          </div>
          <div class="modal-section">
            <h4>Raw Payload</h4>
            <pre id="signal-detail-raw"></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Bot Creation Confirmation Modal -->
    <div id="bot-confirm-modal" class="modal hidden">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h3>Confirm Bot Creation</h3>
          <button id="bot-confirm-close" class="modal-close">√ó</button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 20px; color: var(--tbl-text);">Please review the bot configuration before creating:</p>
          <div id="bot-confirm-details" style="background-color: var(--tbl-bg-alt); padding: 16px; border-radius: 6px; border: 1px solid var(--tbl-border);">
            <!-- Details will be populated by JavaScript -->
          </div>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--tbl-border);">
          <button id="bot-confirm-cancel" class="action-btn" style="background-color: var(--tbl-bg-alt); color: var(--tbl-text);">Cancel</button>
          <button id="bot-confirm-submit" class="action-btn">Confirm & Create</button>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/dashboard.js"></script>
</body>
</html>
